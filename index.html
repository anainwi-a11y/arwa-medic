<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARWA GEST - Central Hub</title>
    <style>
        :root { --primary: #0f172a; --accent: #1e40af; --bg: #f8fafc; --card: #ffffff; --text-main: #1e293b; }
        [data-theme="dark"] { --primary: #1e293b; --accent: #3b82f6; --bg: #0f172a; --card: #1e293b; --text-main: #f1f5f9; }
        
        body, html { 
            margin: 0; 
            padding: 0; 
            min-height: 100vh; 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: var(--bg); 
            color: var(--text-main); 
            transition: 0.3s; 
            /* Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¶Ø§Ù Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ù„Ø£Ø³ÙÙ„ */
            overscroll-behavior-y: contain; 
        }
        
        #mainMenu { display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .header-brand { text-align: center; margin-bottom: 30px; margin-top: 10px; }
        .header-brand h1 { color: var(--primary); font-size: 2.5rem; margin: 0; letter-spacing: 3px; font-weight: 900; }
        .header-brand p { color: var(--accent); font-weight: bold; margin-top: 5px; }
        .menu-container { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 15px; }
        .nav-button {
            background: var(--card); border: 1px solid #e2e8f0; padding: 18px;
            border-radius: 18px; display: flex; align-items: center; gap: 15px;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            transition: 0.3s; color: var(--text-main);
        }
        .nav-button:hover { transform: translateY(-3px); border-color: var(--accent); }
        .icon { width: 45px; height: 45px; background: #f1f5f9; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; }
        #appContainer { display: none; width: 100%; min-height: 100vh; background: var(--bg); }
        .back-bar { background: var(--primary); color: white; padding: 15px 20px; display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: bold; position: sticky; top: 0; z-index: 9999; }
        
        .theme-switch { position: absolute; top: 20px; left: 20px; cursor: pointer; padding: 10px; background: var(--card); border-radius: 50%; border: 1px solid var(--accent); }

        .modal { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.95); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-content { background: var(--card); padding: 0; border-radius: 24px; width: 85%; max-width: 350px; text-align: center; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); animation: slideUp 0.3s ease-out; color: var(--text-main); }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { background: linear-gradient(135deg, var(--primary), var(--accent)); padding: 30px 20px; color: white; position: relative; }
        .dev-img { width: 100px; height: 100px; border-radius: 50%; border: 4px solid white; background: #eee; object-fit: cover; margin-bottom: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .modal-body { padding: 25px; text-align: right; }
        .info-row { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; font-size: 0.95rem; color: var(--text-main); opacity: 0.8; }
        .info-row i { font-style: normal; font-size: 1.2rem; filter: grayscale(1); }
        .fb-btn { display: flex; align-items: center; justify-content: center; gap: 10px; background: #1877f2; color: white; padding: 12px; border-radius: 12px; text-decoration: none; font-weight: bold; margin-top: 20px; transition: 0.3s; }
        .close-btn { margin-top: 15px; display: block; color: #94a3b8; cursor: pointer; font-size: 0.85rem; padding-bottom: 20px; }
    </style>
</head>
<body>

    <div id="mainMenu">
        <div class="theme-switch" onclick="toggleTheme()">ğŸŒ“</div>
        <div class="header-brand">
            <h1>ARWA GEST</h1>
            <p>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - ARWA MEDIC</p>
        </div>
        <div class="menu-container">
            <div class="nav-button" onclick="launchApp('reports')">
                <div class="icon">ğŸ“Š</div>
                <div><b>Gestionnaire des Rapports</b><br><small>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ù…Ù†Ø¨Ù‡Ø§Øª</small></div>
            </div>
            <div class="nav-button" onclick="launchApp('tasks')">
                <div class="icon">ğŸ“‹</div>
                <div><b>Gestionnaire des TÃ¢ches</b><br><small>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø¥Ø²Ø§Ø­Ø©</small></div>
            </div>
            <div class="nav-button" onclick="launchApp('cleaning')">
                <div class="icon">ğŸ§¹</div>
                <div><b>Nettoyage Salle</b><br><small>Ù‚Ø±Ø¹Ø© ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</small></div>
            </div>
            <div class="nav-button" style="background: var(--primary); color: white; margin-top: 20px; justify-content: center;" onclick="toggleModal(true)">
                <span>ğŸ‘¨â€ğŸ’» Ù…Ø·ÙˆØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Info</span>
            </div>
        </div>
    </div>

    <div id="appContainer">
        <div class="back-bar" onclick="goHome()"><span>â¬…ï¸</span> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div id="injectArea"></div>
    </div>

    <div class="modal" id="devModal">
        <div class="modal-content">
            <div class="modal-header">
                <img src="https://media.licdn.com/dms/image/v2/C4D0BAQGaeAYON-oOvA/company-logo_200_200/company-logo_200_200/0/1630527974765/arwamedic_logo?e=2147483647&v=beta&t=evPFBkTyamZjOc-OjU6RiV9KUUs7lMsqdSvScvssp-c" alt="Youssef" class="dev-img">
                <h2 style="margin:0; font-size: 1.4rem;">ÙŠÙˆØ³Ù Ù‡Ø¯ÙŠ</h2>
                <p style="margin:5px 0 0; opacity: 0.9;">Youssef Hadi</p>
            </div>
            <div class="modal-body">
                <div class="info-row"><i>ğŸ“…</i> <b>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</b> 1992</div>
                <div class="info-row"><i>ğŸ¢</i> <b>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</b> Ø³Ø¨ØªÙ…Ø¨Ø± 2025</div>
                <div class="info-row"><i>ğŸ› ï¸</i> <b>Ø§Ù„Ù…Ù‡Ù…Ø©:</b> OpÃ©rateur - Suremballage</div>
                <div class="info-row"><i>ğŸ“</i> <b>Ø§Ù„Ù…Ù‚Ø±:</b> ARWA MEDIC</div>
                <a href="https://www.facebook.com/share/1H3MzWTaeQ/" target="_blank" class="fb-btn"><span>ØµÙØ­Ø© Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ</span></a>
                <span class="close-btn" onclick="toggleModal(false)">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©</span>
            </div>
        </div>
    </div>

    <script id="code_reports" type="text/plain">
        <div id="alarmAppContent">
            <style>#alarmAppContent { direction: rtl; font-family: 'Arial', sans-serif; background: var(--bg); color: var(--text-main); min-height: 100vh; padding-bottom: 50px; } .header-alarm { background: var(--card); padding: 10px; display: flex; flex-direction: column; align-items: center; border-bottom: 4px solid var(--accent); } .app-title-alarm { font-weight: 900; font-size: 1.1rem; color: var(--accent); cursor: pointer; } .lang-pills { display: flex; gap: 5px; background: #cbd5e1; padding: 3px; border-radius: 10px; margin-top: 5px; } .pill { padding: 4px 12px; font-size: 0.8rem; cursor: pointer; font-weight: 900; color: #1e293b; } .pill.active { background: var(--accent); color: white; border-radius: 7px; } .base-card { background: var(--card); margin: 5px 10px; padding: 10px; border-radius: 15px; text-align: center; border: 2px solid var(--accent); } .monitoring-area { display: flex; flex-direction: column; gap: 10px; padding: 10px; } .task-card { background: var(--card); border-radius: 18px; padding: 15px; border: 2px solid #94a3b8; box-shadow: 0 4px 8px rgba(0,0,0,0.05); } .device-name { font-size: 1.4rem; font-weight: 900; background: #eef2f3; color: #1e293b; border-radius: 10px; padding: 5px; text-align: center; margin-bottom: 10px; } .timer-val-big { font-size: 3rem; font-weight: 900; text-align: center; font-family: 'Impact', sans-serif; line-height: 1; margin: 10px 0; } .next-alarm-box { background: #dfe6ed; text-align: center; padding: 6px; border-radius: 8px; font-weight: 900; font-size: 1.2rem; color: #1e40af; margin-bottom: 10px; } .controls { display: flex; justify-content: space-between; gap: 10px; } .btn-action { flex: 1; padding: 15px 0; border-radius: 15px; border: none; font-weight: 900; font-size: 1.5rem; cursor: pointer; color: white; } .btn-start { background: var(--accent); } .btn-reset { background: #dc2626; } select { padding: 10px; border-radius: 10px; font-weight: 900; font-size: 1.1rem; border: 2px solid #cbd5e1; } .modal-alarm { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 99999; } .modal-content-alarm { background: var(--card); color: var(--text-main); width: 90%; border-radius: 20px; padding: 20px; text-align: center; }</style>
            <div class="header-alarm"><div class="app-title-alarm" onclick="window.toggleM('infoM', true)">ğŸ›¡ï¸ ARWA MEDIC (salle suremballage) â“˜</div><div class="lang-pills"><div class="pill active" id="tab-ar" onclick="window.setL('ar')">AR</div><div class="pill" id="tab-fr" onclick="window.setL('fr')">FR</div></div></div>
            <div class="base-card"><div id="liveClock" style="font-size:2rem; font-weight:900; color:var(--accent);">00:00</div><input type="time" id="timeInput" onchange="document.getElementById('liveClock').innerText=this.value" style="font-size:1.1rem; border-radius: 5px; border: 1px solid #ccc;"></div>
            <div class="monitoring-area"><div class="task-card"><div id="lblNameScale" class="device-name">Ø§Ù„Ù…ÙŠØ²Ø§Ù†</div><div class="timer-val-big" id="timerScaleBig">00:00:00</div><div class="next-alarm-box"><span id="timerScaleNext">--:--</span></div><div class="controls"><select id="intScale" onchange="window.tasks.scale.interval=parseInt(this.value)"><option value="15">15M</option><option value="30">30M</option></select><button class="btn-action btn-start" id="btnScale" onclick="window.handleT('scale')">Ø¨Ø¯Ø¡</button></div></div><div class="task-card"><div id="lblNameAuto1" class="device-name">Ø£ÙˆØªÙˆÙƒÙ„Ø§Ù 1</div><div class="timer-val-big" id="timerAuto1Big">00:00:00</div><div class="next-alarm-box"><span id="timerAuto1Next">--:--</span></div><div class="controls"><div style="flex:1"></div><button class="btn-action btn-start" id="btnAuto1" onclick="window.handleT('auto1')">Ø¨Ø¯Ø¡</button></div></div><div class="task-card"><div id="lblNameAuto2" class="device-name">Ø£ÙˆØªÙˆÙƒÙ„Ø§Ù 2</div><div class="timer-val-big" id="timerAuto2Big">00:00:00</div><div class="next-alarm-box"><span id="timerAuto2Next">--:--</span></div><div class="controls"><div style="flex:1"></div><button class="btn-action btn-start" id="btnAuto2" onclick="window.handleT('auto2')">Ø¨Ø¯Ø¡</button></div></div></div>
            <div class="modal-alarm" id="infoM"><div class="modal-content-alarm"><h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h3><p>Ø§Ù„Ù…Ø·ÙˆØ±: ÙŠÙˆØ³Ù Ù‡Ø¯ÙŠ</p><p> Ø´Ø±ÙƒØ© Ø£Ø±ÙˆÙ‰ Ù…ÙŠØ¯ÙŠÙƒ Ø´Ø±ÙƒØ© Ù…ØºØ±Ø¨ÙŠØ© ØªØ£Ø³Ø³Øª ÙÙŠ Ù…Ø§Ø±Ø³ 2017 </p><button onclick="window.toggleM('infoM', false)" style="padding:10px 20px; background:#000; color:#fff; border-radius:10px; border:none; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button></div></div>
            <div class="modal-alarm" id="alarmM"><div class="modal-content-alarm"><div style="font-size:4rem;">ğŸš¨</div><div id="alarmDevice" style="font-size:2rem; font-weight:900; color:#dc2626;"></div><p id="alarmMsgFull" style="font-size:1.2rem; font-weight:bold; margin:15px 0;"></p><button onclick="window.stopS()" style="padding:15px 30px; background:#dc2626; color:#fff; border-radius:10px; border:none; font-weight:bold; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</button></div></div>
        </div>
        <script>
            window.trans = { ar: { start: "Ø¨Ø¯Ø¡", reset: "Ø­Ø°Ù", preMsg: "Ø¨Ø§Ù‚ÙŠ Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†ØŒ ÙŠØ±Ø¬Ù‰ Ø·Ù„Ø¨ Ø£Ø±Ø¨Ø¹ Ø¹Ø¨ÙˆØ§Øª Ù…Ù† Ù…ØµÙ„Ø­Ø© Ø§Ù„Ø¨Ù„ÙŠÙ…Ø§Ø·.", scale: "Ø§Ù„Ù…ÙŠØ²Ø§Ù†", auto1: "Ø£ÙˆØªÙˆÙƒÙ„Ø§Ù 1", auto2: "Ø£ÙˆØªÙˆÙƒÙ„Ø§Ù 2" }, fr: { start: "DÃ©marrer", reset: "Effacer", preMsg: "Il reste 2 min, demandez 4 poches au Plumat.", scale: "Balance", auto1: "Autoclave 1", auto2: "Autoclave 2" } };
            window.lang = 'ar'; window.tasks = { scale: {active:false, interval:15}, auto1: {active:false, interval:15}, auto2: {active:false, interval:15} };
            window.aCtx = null; window.osc = null; window.vib = null;
            window.toggleM = function(id, s) { document.getElementById(id).style.display = s ? 'flex' : 'none'; };
            window.setL = function(l) { window.lang = l; document.getElementById('alarmAppContent').style.direction = l==='ar'?'rtl':'ltr'; document.querySelectorAll('.pill').forEach(p => p.classList.remove('active')); document.getElementById('tab-'+l).classList.add('active'); for (let id in window.tasks) window.updateUI(id); };
            window.handleT = function(id) { let t = window.tasks[id]; if (!t.active) { let [h, m] = document.getElementById('liveClock').innerText.split(':').map(Number); let d = new Date(); d.setHours(h, m, 0, 0); t.startT = d.getTime(); t.active = true; t.preS = false; } else { t.active = false; window.resetUI(id); } window.updateUI(id); };
            window.resetUI = function(id) { document.getElementById(`timer${id.charAt(0).toUpperCase()+id.slice(1)}Big`).innerText = "00:00:00"; document.getElementById(`timer${id.charAt(0).toUpperCase()+id.slice(1)}Next`).innerText = "--:--"; };
            window.updateUI = function(id) { let t = window.tasks[id], btn = document.getElementById('btn'+id.charAt(0).toUpperCase()+id.slice(1)); if(!btn) return; btn.innerText = t.active ? window.trans[window.lang].reset : window.trans[window.lang].start; btn.className = t.active ? "btn-action btn-reset" : "btn-action btn-start"; document.getElementById('lblNameScale').innerText = window.trans[window.lang].scale; document.getElementById('lblNameAuto1').innerText = window.trans[window.lang].auto1; document.getElementById('lblNameAuto2').innerText = window.trans[window.lang].auto2; };
            window.sound = function() { if(!window.aCtx) window.aCtx = new (window.AudioContext || window.webkitAudioContext)(); window.osc = window.aCtx.createOscillator(); window.osc.connect(window.aCtx.destination); window.osc.start(); window.vib = setInterval(() => navigator.vibrate(500), 1000); };
            window.stopS = function() { if(window.osc){window.osc.stop(); window.osc=null;} if(window.vib) clearInterval(window.vib); window.toggleM('alarmM', false); };
            if(window.timerInt) clearInterval(window.timerInt);
            window.timerInt = setInterval(() => { const now = Date.now(); for (let id in window.tasks) { let t = window.tasks[id]; if (!t.active) continue; let rem = (t.interval * 60000) - ((now - t.startT) % (t.interval * 60000)); let next = t.startT + (Math.floor((now-t.startT)/(t.interval*60000))+1)*(t.interval*60000); let s = Math.floor(rem/1000)%60, m = Math.floor(rem/60000)%60, h = Math.floor(rem/3600000); let big = document.getElementById(`timer${id.charAt(0).toUpperCase()+id.slice(1)}Big`); let nxt = document.getElementById(`timer${id.charAt(0).toUpperCase()+id.slice(1)}Next`); if(big) big.innerText = `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; if(nxt) nxt.innerText = new Date(next).toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'}); if (m === 2 && s === 0 && !t.preS) { document.getElementById('alarmMsgFull').innerText = window.trans[window.lang].preMsg; document.getElementById('alarmDevice').innerText = ""; window.toggleM('alarmM', true); window.sound(); t.preS = true; } if (rem <= 1000) { document.getElementById('alarmDevice').innerText = window.trans[window.lang][id]; document.getElementById('alarmMsgFull').innerText = ""; window.toggleM('alarmM', true); window.sound(); } } }, 1000);
            const it = new Date().toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'}); document.getElementById('timeInput').value = it; document.getElementById('liveClock').innerText = it;
        </script>
    </script>

    <script id="code_tasks" type="text/plain">
        <div id="tasksAppContainer">
            <style>
                #tasksAppContainer { --primary: #1e40af; --success: #25d366; --bg: var(--bg); --danger: #e11d48; font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text-main); padding: 10px; }
                .container-task { max-width: 1000px; margin: auto; background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
                .header-task { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; gap: 10px; }
                .lang-btn-task { background: #475569; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: bold; white-space: nowrap; }
                .setup-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; background: #f8fafc; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #e2e8f0; color: #1e293b; }
                .lunch-section { background: #fffbeb; border: 1px solid #fef3c7; padding: 15px; border-radius: 15px; margin-bottom: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; color: #1e293b; }
                .input-box { display: flex; flex-direction: column; }
                label { font-size: 0.75rem; font-weight: bold; margin-bottom: 5px; color: #64748b; }
                select, input[type="time"] { padding: 10px; border: 1px solid #cbd5e1; border-radius: 10px; background: white; font-size: 0.85rem; color: #1e293b; }
                .btn-plus { background: #16a34a; color: white; border: none; padding: 10px; border-radius: 10px; cursor: pointer; font-weight: bold; }
                .main-btn { background: var(--primary); color: white; border: none; padding: 16px; border-radius: 12px; cursor: pointer; width: 100%; font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; }
                .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; display: none; }
                .whatsapp-btn { background: var(--success); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; }
                .pdf-btn { background: var(--danger); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; }
                .task-card { background: var(--card); border: 2px solid #f1f5f9; border-radius: 15px; padding: 15px; margin-bottom: 15px; }
                .lunch-row { background: #fef3c7 !important; font-weight: bold; color: #92400e; font-size: 0.75rem; }
                table { width: 100%; border-collapse: collapse; margin-top: 10px; color: var(--text-main); }
                th, td { border: 1px solid #f1f5f9; padding: 10px; text-align: center; font-size: 0.85rem; }
                .footer-task { text-align: center; margin-top: 30px; font-size: 0.75rem; color: #94a3b8; border-top: 1px solid #eee; padding-top: 15px; }
            </style>

            <div class="container-task">
                <div class="header-task">
                    <h2 id="titleTask">Salle Suremballage</h2>
                    <button class="lang-btn-task" onclick="window.toggleLanguageTask()" id="langSwitcherTask">FranÃ§ais</button>
                </div>
                <div id="offsetDisplayInTable" style="display:none; color:var(--danger); font-weight:bold; text-align:center; margin-bottom:10px;"></div>

                <div class="setup-section">
                    <div class="input-box"><label id="lblStart">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</label><input type="time" id="startTime" value="17:00"></div>
                    <div class="input-box"><label id="lblEnd">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</label><input type="time" id="endTime" value="01:00"></div>
                    <div class="input-box"><label id="lblOffset">Ø§Ù„Ø¥Ø²Ø§Ø­Ø© (1-6)</label><button class="btn-plus" onclick="window.incrementOffsetTask()" id="offsetBtnTask">+1 (1)</button></div>
                </div>

                <div class="lunch-section">
                    <div class="input-box"><label id="lblLunchStart">ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø© (Ø¨Ø¯Ø§ÙŠØ©)</label><input type="time" id="lunchStart" value="22:00"></div>
                    <div class="input-box"><label id="lblLunchDur">Ù…Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©</label>
                        <select id="lunchDuration"><option value="60">60 Ø¯Ù‚ÙŠÙ‚Ø©</option><option value="30">30 Ø¯Ù‚ÙŠÙ‚Ø©</option><option value="0">0 Ø¯Ù‚ÙŠÙ‚Ø©</option></select>
                    </div>
                </div>

                <div class="setup-section">
                    <div class="input-box"><label id="lblTotalW">Effectif total</label><select id="totalW"></select></div>
                    <div class="input-box"><label id="lblMales">Ø§Ù„Ø£ÙˆØ¨Ø±Ø§ØªÙˆØ±</label><select id="males"></select></div>
                    <div class="input-box"><label id="lblQual">Ø§Ù„Ù…Ø¤Ù‡Ù„ÙŠÙ† Ù„Ù„Ù…ÙŠØ±Ø§Ø¬</label><select id="qual"></select></div>
                    <div class="input-box"><label id="lblTables">Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ÙŠØ±Ø§Ø¬</label><select id="tables"></select></div>
                </div>

                <button class="main-btn" onclick="window.calculateTask()" id="btnGenerateTask">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø¯Ø«</button>
                <div class="action-btns" id="actionGroupTask">
                    <button class="whatsapp-btn" onclick="window.shareWhatsAppTask()" id="btnWATask">ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“±</button>
                    <button class="pdf-btn" onclick="window.print()" id="btnPDFTask">Ø­ÙØ¸ PDF ğŸ“„</button>
                </div>

                <div id="resultsTask"></div>
                <div class="footer-task">Created by YOUSSEF HADI</div>
            </div>

            <script>
                window.currentLangTask = 'ar';
                window.currentOffsetTask = 1;
                window.lastCalcTask = null;

                const dictTask = {
                    ar: { title: "Salle Suremballage", offset: "Ø§Ù„Ø¥Ø²Ø§Ø­Ø©: ", start: "Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¨Ø¦Ø©", end: "Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¨Ø¦Ø©", workers: "Effectif total", males: "Ø§Ù„Ø£ÙˆØ¨Ø±Ø§ØªÙˆØ±", qual: "Ø§Ù„Ù…Ø¤Ù‡Ù„ÙŠÙ† Ù„Ù„Ù…ÙŠØ±Ø§Ø¬", tables: "Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ÙŠØ±Ø§Ø¬", lunchS: "ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø© (Ø¨Ø¯Ø§ÙŠØ©)", lunchD: "Ù…Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©", lunchBreak: "--- Ø§Ø³ØªØ±Ø§Ø­Ø© ---", generate: "ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„", wa: "ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“±", pdf: "Ø­ÙØ¸ PDF ğŸ“„", pair: "Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠ", operator: "Ø§Ù„Ø£ÙˆØ¨Ø±Ø§ØªÙˆØ±", qualified: "Ø§Ù„Ù…Ø¤Ù‡Ù„ Ø±Ù‚Ù…", dur: "Ø¯/Ø¯ÙˆØ±Ø©", min: "Ø¯Ù‚ÙŠÙ‚Ø©" },
                    fr: { title: "Salle Suremballage", offset: "Offset: ", start: "DÃ©but de remplissage", end: "ArrÃªt de remplissage", workers: "Effectif total", males: "OpÃ©rateurs", qual: "QualifiÃ©s pour Mirage", tables: "Tables de Mirage", lunchS: "DÃ©but de pause", lunchD: "DurÃ©e de pause", lunchBreak: "--- Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø© ---", generate: "GÃ©nÃ©rer", wa: "WhatsApp ğŸ“±", pdf: "Sauver PDF ğŸ“„", pair: "BinÃ´me", operator: "OpÃ©rateur", qualified: "QualifiÃ© NÂ°", dur: "min/tour", min: "min" }
                };

                window.fillSelectsTask = function() {
                    const fill = (id, s, e, sel) => {
                        const el = document.getElementById(id); if(!el) return;
                        el.innerHTML = "";
                        for(let i=s; i<=e; i++) {
                            let opt = document.createElement('option');
                            opt.value = i; opt.innerText = i;
                            if(i === sel) opt.selected = true;
                            el.appendChild(opt);
                        }
                    };
                    fill('totalW', 8, 15, 10); fill('males', 1, 15, 7); fill('qual', 1, 15, 6); fill('tables', 1, 5, 3);
                }
                window.fillSelectsTask();

                window.incrementOffsetTask = function() {
                    window.currentOffsetTask = window.currentOffsetTask >= 6 ? 1 : window.currentOffsetTask + 1;
                    document.getElementById('offsetBtnTask').innerText = "+1 (" + window.currentOffsetTask + ")";
                }

                window.toggleLanguageTask = function() {
                    window.currentLangTask = window.currentLangTask === 'ar' ? 'fr' : 'ar';
                    document.getElementById('tasksAppContainer').dir = window.currentLangTask === 'ar' ? 'rtl' : 'ltr';
                    document.getElementById('langSwitcherTask').innerText = window.currentLangTask === 'ar' ? 'FranÃ§ais' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
                    const d = dictTask[window.currentLangTask];
                    document.getElementById('titleTask').innerText = d.title;
                    document.getElementById('lblStart').innerText = d.start;
                    document.getElementById('lblEnd').innerText = d.end;
                    document.getElementById('lblLunchStart').innerText = d.lunchS;
                    document.getElementById('lblLunchDur').innerText = d.lunchD;
                    document.getElementById('lblTotalW').innerText = d.workers;
                    document.getElementById('lblMales').innerText = d.males;
                    document.getElementById('lblQual').innerText = d.qual;
                    document.getElementById('lblTables').innerText = d.tables;
                    document.getElementById('btnGenerateTask').innerText = d.generate;
                    document.getElementById('btnWATask').innerText = d.wa;
                    document.getElementById('btnPDFTask').innerText = d.pdf;
                    if(window.lastCalcTask) window.calculateTask();
                }

                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØµØ§Ø±Ù…Ø©
                window.calculateTask = function() {
                    const toM = (s) => { const [h,m]=s.split(':').map(Number); return h*60+m; };
                    let startM = toM(document.getElementById('startTime').value);
                    let endM = toM(document.getElementById('endTime').value);
                    if (endM <= startM) endM += 1440;
                    
                    const lStart = toM(document.getElementById('lunchStart').value);
                    const lDur = parseInt(document.getElementById('lunchDuration').value);
                    const lEnd = lStart + lDur;

                    const n = parseInt(document.getElementById('totalW').value);
                    const males = parseInt(document.getElementById('males').value);
                    const qual = parseInt(document.getElementById('qual').value);
                    const tCount = parseInt(document.getElementById('tables').value);

                    // ØµØ§ÙÙŠ Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ = Ø§Ù„ÙƒÙ„ÙŠ - Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©
                    const netM = (endM - startM) - lDur;
                    
                    window.lastCalcTask = { 
                        mDur: netM / Math.floor(n/2), 
                        aDur: netM / males, 
                        miragePer: (netM * tCount) / qual,
                        startM, lStart, lDur, lEnd, n, males, qual, endM
                    };

                    document.getElementById('actionGroupTask').style.display = 'grid';
                    document.getElementById('offsetDisplayInTable').style.display = 'block';
                    document.getElementById('offsetDisplayInTable').innerText = dictTask[window.currentLangTask].offset + window.currentOffsetTask;
                    
                    let html = `<div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:20px;">`;
                    html += window.genCardTask(`Multivac (${Math.floor(window.lastCalcTask.mDur)} ${dictTask[window.currentLangTask].min})`, Math.floor(n/2), window.lastCalcTask.mDur, dictTask[window.currentLangTask].pair, startM, endM, lStart, lDur, lEnd, window.currentOffsetTask);
                    html += window.genCardTask(`Alimentation (${Math.floor(window.lastCalcTask.aDur)} ${dictTask[window.currentLangTask].min})`, males, window.lastCalcTask.aDur, dictTask[window.currentLangTask].operator, startM, endM, lStart, lDur, lEnd, window.currentOffsetTask);
                    
                    let mirHtml = `<div class="task-card"><h3>Mirage</h3><table>`;
                    for(let i=1; i<=qual; i++) { 
                        let shiftedMir = ((i + window.currentOffsetTask - 2) % qual) + 1;
                        mirHtml += `<tr><td>${dictTask[window.currentLangTask].qualified} ${shiftedMir}</td><td><b>${Math.floor(window.lastCalcTask.miragePer)} ${dictTask[window.currentLangTask].min}</b></td></tr>`; 
                    }
                    html += mirHtml + `</table></div></div>`;
                    document.getElementById('resultsTask').innerHTML = html;
                }

                // Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙŠ ØªØ·Ø¨Ù‚ Ù…Ù†Ø·Ù‚ P1/P2
                window.genCardTask = function(title, count, duration, label, start, endLimit, lStart, lDur, lEnd, offset) {
                    let rows = ""; 
                    let currentPos = start; 
                    const fmt = (m) => `${(Math.floor(m/60)%24).toString().padStart(2,'0')}:${(Math.floor(m%60)).toString().padStart(2,'0')}`;

                    for(let i=0; i < count; i++) {
                        let workerId = ((i + (offset || 1) - 1) % count) + 1;
                        let timeLeft = duration;
                        let sW = workerId;

                        // Ø§Ù„Ø­Ø§Ù„Ø© 1: Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©
                        if (currentPos < lStart) {
                            let spaceBefore = lStart - currentPos;
                            if (spaceBefore >= timeLeft) {
                                let wEnd = currentPos + timeLeft;
                                if (i === count - 1) wEnd = endLimit;
                                rows += `<tr><td>${fmt(currentPos)} - ${fmt(wEnd)}</td><td><b>${label} ${sW}</b></td></tr>`;
                                currentPos = wEnd;
                            } else {
                                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ù‚Øµ: P1 Ø«Ù… Ø§Ø³ØªØ±Ø§Ø­Ø© Ø«Ù… P2
                                rows += `<tr><td>${fmt(currentPos)} - ${fmt(lStart)}</td><td><b>${label} ${sW} (P1)</b></td></tr>`;
                                rows += `<tr class="lunch-row"><td colspan="2">${dictTask[window.currentLangTask].lunchBreak}</td></tr>`;
                                let rem = timeLeft - spaceBefore;
                                let p2End = lEnd + rem;
                                if (i === count - 1) p2End = endLimit;
                                rows += `<tr><td>${fmt(lEnd)} - ${fmt(p2End)}</td><td><b>${label} ${sW} (P2)</b></td></tr>`;
                                currentPos = p2End;
                            }
                        } 
                        // Ø§Ù„Ø­Ø§Ù„Ø© 2: Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©
                        else {
                            if (currentPos < lEnd) currentPos = lEnd;
                            let wEnd = currentPos + timeLeft;
                            if (i === count - 1) wEnd = endLimit;
                            rows += `<tr><td>${fmt(currentPos)} - ${fmt(wEnd)}</td><td><b>${label} ${sW}</b></td></tr>`;
                            currentPos = wEnd;
                        }
                    }
                    return `<div class="task-card"><h3>${title}</h3><table>${rows}</table></div>`;
                }

                window.shareWhatsAppTask = function() {
                    const d = dictTask[window.currentLangTask]; const fmt = (m) => `${(Math.floor(m/60)%24).toString().padStart(2,'0')}:${(Math.floor(m%60)).toString().padStart(2,'0')}`;
                    let msg = `*ğŸš€ ${d.title} (ARWA MEDIC) ğŸš€*%0A*Offset:* ${window.currentOffsetTask}%0A%0A`;
                    msg += document.getElementById('resultsTask').innerText.replace(/\n/g, '%0A');
                    window.open("https://wa.me/?text=" + msg);
                }
            </script>
        </div>
    </script>

    <script id="code_cleaning" type="text/plain">
        <div id="lotteryAppContainer">
            <style>#lotteryAppContainer { --primary: #0284c7; --success: #22c55e; --bg: var(--bg); --danger: #ef4444; --accent: #1e40af; font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text-main); padding: 10px; } .container-lot { max-width: 800px; margin: auto; background: var(--card); padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); } .header-lot { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f1f5f9; padding-bottom: 15px; margin-bottom: 20px; gap: 10px; } .lang-btn-lot { background: #475569; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: bold; white-space: nowrap; } .setup-box { background: #f1f5f9; padding: 15px; border-radius: 15px; margin-bottom: 20px; color: #1e293b; } .input-row { display: flex; gap: 10px; margin-bottom: 10px; } input, select { padding: 12px; border: 1px solid #cbd5e1; border-radius: 10px; font-size: 0.9rem; color: #1e293b; } input[type="text"] { flex: 1; } .btn { border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; color: white; } .btn-add { background: var(--primary); } .btn-draw { background: var(--accent); width: 100%; font-size: 1.1rem; margin-top: 10px; } .worker-tag { display: inline-flex; align-items: center; background: white; padding: 5px 12px; border-radius: 20px; margin: 5px; border: 1px solid #e2e8f0; font-size: 0.85rem; color: #1e293b; } .worker-tag button { background: none; border: none; color: var(--danger); margin-right: 8px; cursor: pointer; } #loaderLot { display: none; text-align: center; margin: 30px 0; } .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--accent); border-radius: 50%; animation: spinLot 1s linear infinite; margin: auto; } @keyframes spinLot { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } table { width: 100%; border-collapse: collapse; margin-top: 10px; color: var(--text-main); } th, td { border: 1px solid #f1f5f9; padding: 12px; text-align: center; } .hall-title { color: var(--accent); font-weight: bold; margin-top: 10px; display: block; text-align: center; text-decoration: underline; font-size: 1.2rem; } .names-list { font-size: 1.2rem; font-weight: bold; color: var(--text-main); display: block; margin: 10px 0; text-align: center; } .lot-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }</style>
            <div class="container-lot"><div class="header-lot"><div><h2 id="mainTitleLot" style="margin:0;">Salle Suremballage</h2><p id="subTitleLot" style="color: #64748b; font-size: 0.85rem; margin: 5px 0 0 0;">Ù†Ø¸Ø§Ù… ØªÙ†Ø¸ÙŠÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</p></div><button class="lang-btn-lot" onclick="window.toggleLanguageLottery()" id="langSwitcherLot">FranÃ§ais</button></div><div class="setup-box"><label id="lblAddLot" style="font-weight: bold; font-size: 0.85rem;">1. Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ØªÙˆÙØ±ÙŠÙ†:</label><div class="input-row"><input type="text" id="workerNameLot" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„..."><button class="btn btn-add" id="btnAddLot" onclick="window.addWorkerLottery()">Ø¥Ø¶Ø§ÙØ© +</button></div><div id="workersListLot"></div></div><div class="setup-box"><div class="input-row"><div style="flex:1"><label id="lblModeLot" style="font-weight: bold; font-size: 0.85rem;">2. Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ²ÙŠØ¹:</label><select id="hallModeLot" onchange="window.toggleOptionsLottery()" style="width:100%"><option value="1">Ù‚Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© (Ø£Ø³Ø¨ÙˆØ¹ÙŠ)</option><option value="2">Ù‚Ø§Ø¹ØªØ§Ù† (ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ÙƒÙ„)</option></select></div><div style="flex:1" id="dailyOptionLot"><label id="lblPerDayLot" style="font-weight: bold; font-size: 0.85rem;">3. Ø¹Ù…Ø§Ù„ Ù„ÙƒÙ„ ÙŠÙˆÙ…:</label><select id="perDayLot" style="width:100%"><option value="2">2</option><option value="3">3</option></select></div></div><button class="btn btn-draw" id="btnDrawLot" onclick="window.runLotteryLottery()">Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù‚Ø±Ø¹Ø© ğŸ²</button></div><div id="loaderLot"><div class="spinner"></div><div id="loadingTxtLot" style="color:var(--accent); font-weight:bold; margin-top:15px;">Ø¬Ø§Ø±ÙŠ Ø®Ù„Ø· Ø§Ù„Ø£Ø³Ù…Ø§Ø¡...</div></div><div id="resultAreaLot" style="display:none; margin-top:20px; border:2px solid #e2e8f0; border-radius:15px; padding:15px;"><div id="currentDateDisplayLot" style="font-weight:bold; text-align:center; margin-bottom:15px; color:#475569;"></div><div id="outputContentLot"></div><div class="lot-actions"><button class="btn" style="background:#25d366" onclick="window.shareLotteryWA()" id="btnLotWA">ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“±</button><button class="btn" style="background:#e11d48" onclick="window.print()" id="btnLotPDF">Ø­ÙØ¸ PDF ğŸ“„</button></div></div></div>
            <script>
                window.currentLangLot = 'ar'; window.workersLot = [];
                const dictLot = { ar: { sub: "Ù†Ø¸Ø§Ù… ØªÙ†Ø¸ÙŠÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª", add: "1. Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ØªÙˆÙØ±ÙŠÙ†:", place: "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„...", addBtn: "Ø¥Ø¶Ø§ÙØ© +", mode: "2. Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ²ÙŠØ¹:", mode1: "Ù‚Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© (Ø£Ø³Ø¨ÙˆØ¹ÙŠ)", mode2: "Ù‚Ø§Ø¹ØªØ§Ù† (ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ÙƒÙ„)", perDay: "3. Ø¹Ù…Ø§Ù„ Ù„ÙƒÙ„ ÙŠÙˆÙ…:", draw: "Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù‚Ø±Ø¹Ø© ğŸ²", loading: "Ø¬Ø§Ø±ÙŠ Ø®Ù„Ø· Ø§Ù„Ø£Ø³Ù…Ø§Ø¡...", datePre: "ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…: ", hall1: "Salle Suremballage", hall2: "Amarow", days: ["Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"], wa: "ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“±", pdf: "Ø­ÙØ¸ PDF ğŸ“„", luck: "Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚ Ù„Ù„Ø¬Ù…ÙŠØ¹!" }, fr: { sub: "SystÃ¨me de Nettoyage", add: "1. Liste des ouvriers:", place: "Nom de l'ouvrier...", addBtn: "Ajouter +", mode: "2. SystÃ¨me de distribution:", mode1: "Une salle (Hebdo)", mode2: "Deux salles (Division)", perDay: "3. Ouvriers par jour:", draw: "Lancer le tirage ğŸ²", loading: "MÃ©lange des noms...", datePre: "Date: ", hall1: "Salle Suremballage", hall2: "Amarow", days: ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"], wa: "WhatsApp ğŸ“±", pdf: "Sauver PDF ğŸ“„", luck: "Bonne chance!" } };
                window.toggleLanguageLottery = function() { window.currentLangLot = window.currentLangLot === 'ar' ? 'fr' : 'ar'; const d = dictLot[window.currentLangLot]; document.getElementById('lotteryAppContainer').dir = window.currentLangLot === 'ar' ? 'rtl' : 'ltr'; document.getElementById('langSwitcherLot').innerText = window.currentLangLot === 'ar' ? 'FranÃ§ais' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'; document.getElementById('subTitleLot').innerText = d.sub; document.getElementById('lblAddLot').innerText = d.add; document.getElementById('workerNameLot').placeholder = d.place; document.getElementById('btnAddLot').innerText = d.addBtn; document.getElementById('lblModeLot').innerText = d.mode; document.getElementById('btnDrawLot').innerText = d.draw; document.getElementById('btnLotWA').innerText = d.wa; document.getElementById('btnLotPDF').innerText = d.pdf; if(window.workersLot.length > 0 && document.getElementById('resultAreaLot').style.display === 'block') window.generateDrawLottery(); };
                window.addWorkerLottery = function() { const input = document.getElementById('workerNameLot'); const name = input.value.trim(); if(name && !window.workersLot.includes(name)) { window.workersLot.push(name); window.renderWorkersLottery(); input.value = ''; } };
                window.renderWorkersLottery = function() { document.getElementById('workersListLot').innerHTML = window.workersLot.map((w, i) => `<span class="worker-tag">${w} <button onclick="window.removeWorkerLottery(${i})">Ã—</button></span>`).join(''); };
                window.removeWorkerLottery = function(index) { window.workersLot.splice(index, 1); window.renderWorkersLottery(); };
                window.toggleOptionsLottery = function() { const mode = document.getElementById('hallModeLot').value; document.getElementById('dailyOptionLot').style.visibility = (mode === "1") ? "visible" : "hidden"; };
                window.runLotteryLottery = function() { if(window.workersLot.length < 2) return alert(window.currentLangLot === 'ar' ? "Ø£Ø¶Ù Ø¹Ù…Ø§Ù„Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹!" : "Ajoutez des ouvriers!"); document.getElementById('resultAreaLot').style.display = 'none'; document.getElementById('btnDrawLot').disabled = true; document.getElementById('loaderLot').style.display = 'block'; setTimeout(() => { window.generateDrawLottery(); document.getElementById('loaderLot').style.display = 'none'; document.getElementById('resultAreaLot').style.display = 'block'; document.getElementById('btnDrawLot').disabled = false; }, 3000); };
                window.generateDrawLottery = function() { 
                    const mode = document.getElementById('hallModeLot').value; 
                    const d = dictLot[window.currentLangLot]; 
                    const dateStr = new Date().toLocaleDateString(window.currentLangLot === 'ar' ? 'ar-MA' : 'fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }); 
                    document.getElementById('currentDateDisplayLot').innerText = d.datePre + dateStr; 
                    let shuf = [...window.workersLot].sort(() => Math.random() - 0.5); 
                    let html = ''; 
                    if(mode === "1") { 
                        const perDay = parseInt(document.getElementById('perDayLot').value); 
                        while(shuf.length < (d.days.length * perDay)) shuf = shuf.concat([...window.workersLot].sort(() => Math.random() - 0.5)); 
                        html = `<table><thead><tr><th>${window.currentLangLot==='ar'?'Ø§Ù„ÙŠÙˆÙ…':'Jour'}</th><th>${window.currentLangLot==='ar'?'Ø§Ù„Ù…Ù†Ø¸ÙÙŠÙ†':'Nettoyage'}</th></tr></thead><tbody>`; 
                        let idx = 0; d.days.forEach(day => { let group = shuf.slice(idx, idx + perDay); idx += perDay; html += `<tr><td><b>${day}</b></td><td>${group.join(' - ')}</td></tr>`; }); 
                        html += `</tbody></table>`; 
                    } else { 
                        const half = Math.ceil(shuf.length / 2); 
                        window.lotResH1 = shuf.slice(0, half); window.lotResH2 = shuf.slice(half);
                        html = `<span class="hall-title">ğŸ“ ${d.hall1}</span><span class="names-list">${window.lotResH1.join(' - ')}</span><hr style="border:1px solid #f1f5f9; margin:15px 0;"><span class="hall-title">ğŸ“ ${d.hall2}</span><span class="names-list">${window.lotResH2.join(' - ')}</span>`; 
                    } 
                    document.getElementById('outputContentLot').innerHTML = html; 
                };
                window.shareLotteryWA = function() { 
                    const d = dictLot[window.currentLangLot];
                    const dateStr = document.getElementById('currentDateDisplayLot').innerText; 
                    let msg = `*ğŸ§¹ ${d.sub} (ARWA MEDIC) ğŸ§¹*%0A%0Aâœ¨ *${dateStr}* âœ¨%0A%0A`;
                    const mode = document.getElementById('hallModeLot').value;
                    if(mode === "2") {
                        msg += `*ğŸ¢ ${d.hall1}:*%0AğŸ‘¤ ${window.lotResH1.join(' %0AğŸ‘¤ ')}%0A%0A`;
                        msg += `*ğŸ“¦ ${d.hall2}:*%0AğŸ‘¤ ${window.lotResH2.join(' %0AğŸ‘¤ ')}%0A%0A`;
                    } else {
                        msg += document.getElementById('outputContentLot').innerText.replace(/\n/g, '%0A');
                    }
                    msg += `%0AğŸ€ *${d.luck}*`; 
                    window.open("https://wa.me/?text=" + msg); 
                }
            </script>
        </div>
    </script>

    <script>
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            if (currentTheme === 'dark') {
                body.removeAttribute('data-theme');
            } else {
                body.setAttribute('data-theme', 'dark');
            }
        }

        function toggleModal(s){ document.getElementById('devModal').style.display=s?'flex':'none'; }
        function launchApp(id){
            const mainMenu = document.getElementById('mainMenu');
            const appContainer = document.getElementById('appContainer');
            const injectArea = document.getElementById('injectArea');
            let rawCode = document.getElementById('code_'+id).innerHTML;
            injectArea.innerHTML = rawCode;
            const scripts = injectArea.getElementsByTagName("script");
            for (let i = 0; i < scripts.length; i++) {
                const newScript = document.createElement("script");
                newScript.text = scripts[i].text;
                document.head.appendChild(newScript).parentNode.removeChild(newScript);
            }
            mainMenu.style.display = 'none';
            appContainer.style.display = 'block';
            window.scrollTo(0,0);
        }
        function goHome(){ location.reload(); }
    </script>
</body>
</html>
